{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\Programming\\\\Projects\\\\Lets-Buy-master\\\\Lets-Buy-master\\\\lets buy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Programming\\\\Projects\\\\Lets-Buy-master\\\\Lets-Buy-master\\\\lets buy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\Programming\\\\Projects\\\\Lets-Buy-master\\\\Lets-Buy-master\\\\lets buy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";/* eslint-disable no-unused-vars */import React,{useEffect,useState}from'react';import\"./Payment.css\";import{useStateValue}from\"./StateProvider\";import CheckoutProduct from\"./CheckoutProduct\";import{Link,useHistory}from'react-router-dom';import{CardElement,useElements,useStripe}from'@stripe/react-stripe-js';import CurrencyFormat from'react-currency-format';import{getBasketTotal}from'./reducer';import axios from\"./axios\";import{db}from'./firebase';function Payment(){var _useStateValue=useStateValue(),_useStateValue2=_slicedToArray(_useStateValue,2),_useStateValue2$=_useStateValue2[0],basket=_useStateValue2$.basket,user=_useStateValue2$.user,dispatch=_useStateValue2[1];var history=useHistory();var stripe=useStripe();var elements=useElements();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),processing=_useState2[0],setProcessing=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),succeeded=_useState4[0],setSucceeded=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),disabled=_useState8[0],setDisabled=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];useEffect(function(){var getClientSecret=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios({method:'post',url:\"/payments/create?total=\".concat(getBasketTotal(basket)*100)});case 2:response=_context.sent;setClientSecret(response.data.clientSecret);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getClientSecret(){return _ref.apply(this,arguments);};}();getClientSecret();},[basket]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var payload;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();setProcessing(true);_context2.next=4;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement)}}).then(function(_ref3){var paymentIntent=_ref3.paymentIntent;db.collection('users').doc(user===null||user===void 0?void 0:user.uid).collection('orders').doc(paymentIntent.id).set({basket:basket,amount:paymentIntent.amount,created:paymentIntent.created});setSucceeded(true);setError(null);setProcessing(false);dispatch({type:\"EMPTY_BASKET\"});history.replace(\"/orders\");});case 4:payload=_context2.sent;case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handleChange=function handleChange(event){setDisabled(event.empty);setError(event.error?event.error.message:\"\");};return/*#__PURE__*/React.createElement(\"div\",{className:\"payment\"},/*#__PURE__*/React.createElement(\"div\",{className:\"payment__container\"},/*#__PURE__*/React.createElement(\"h1\",null,\"Checkout (\",/*#__PURE__*/React.createElement(Link,{to:\"/checkout\"},basket===null||basket===void 0?void 0:basket.length,\" items\"),\")\"),/*#__PURE__*/React.createElement(\"div\",{className:\"payment__section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"payment__title\"},/*#__PURE__*/React.createElement(\"h3\",null,\"Delivery Address\")),/*#__PURE__*/React.createElement(\"div\",{className:\"payment__address\"},/*#__PURE__*/React.createElement(\"p\",null,!user?\"Guest\":user===null||user===void 0?void 0:user.email),/*#__PURE__*/React.createElement(\"textarea\",{cols:\"30\",rows:\"5\",placeholder:\"Enter address\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"payment__section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"payment__title\"},/*#__PURE__*/React.createElement(\"h3\",null,\"Review items and delivery\")),/*#__PURE__*/React.createElement(\"div\",{className:\"payment__items\"},basket.map(function(item){return/*#__PURE__*/React.createElement(CheckoutProduct,{id:item.id,image:item.image,title:item.title,price:item.price,rating:item.rating});}))),/*#__PURE__*/React.createElement(\"div\",{className:\"payment__section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"payment__title\"},/*#__PURE__*/React.createElement(\"h3\",null,\"Payment Method\")),/*#__PURE__*/React.createElement(\"div\",{className:\"payment__details\"},/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit},/*#__PURE__*/React.createElement(CardElement,{onChange:handleChange}),/*#__PURE__*/React.createElement(\"div\",{className:\"payment__priceContainer\"},/*#__PURE__*/React.createElement(CurrencyFormat,{renderText:function renderText(value){return/*#__PURE__*/React.createElement(\"h3\",null,\"Order Total: \",value);},decimalScale:2,value:getBasketTotal(basket),displayType:\"text\",thousandSeparator:true,prefix:\"$\"}),/*#__PURE__*/React.createElement(\"button\",{disabled:processing||disabled||succeeded},/*#__PURE__*/React.createElement(\"span\",null,processing?/*#__PURE__*/React.createElement(\"p\",null,\"Processing\"):\"Buy now\"))),error&&/*#__PURE__*/React.createElement(\"div\",null,error))))));}export default Payment;","map":{"version":3,"names":["React","useEffect","useState","useStateValue","CheckoutProduct","Link","useHistory","CardElement","useElements","useStripe","CurrencyFormat","getBasketTotal","axios","db","Payment","basket","user","dispatch","history","stripe","elements","processing","setProcessing","succeeded","setSucceeded","error","setError","disabled","setDisabled","clientSecret","setClientSecret","getClientSecret","method","url","response","data","handleSubmit","event","preventDefault","confirmCardPayment","payment_method","card","getElement","then","paymentIntent","collection","doc","uid","id","set","amount","created","type","replace","payload","handleChange","empty","message","length","email","map","item","image","title","price","rating","value"],"sources":["D:/Programming/Projects/Lets-Buy-master/Lets-Buy-master/lets buy/src/Payment.js"],"sourcesContent":["/* eslint-disable no-unused-vars */\nimport React, { useEffect, useState } from 'react';\nimport \"./Payment.css\";\nimport { useStateValue } from \"./StateProvider\";\nimport CheckoutProduct from \"./CheckoutProduct\";\nimport { Link, useHistory } from 'react-router-dom';\nimport { CardElement, useElements, useStripe } from '@stripe/react-stripe-js';\nimport CurrencyFormat from 'react-currency-format';\nimport { getBasketTotal } from './reducer';\nimport axios from \"./axios\";\nimport { db } from './firebase';\n\nfunction Payment() {\n    const [{ basket, user }, dispatch] = useStateValue();\n    const history = useHistory();\n\n    const stripe = useStripe();\n    const elements = useElements();\n\n    const [processing, setProcessing] = useState(\"\");\n    const [succeeded, setSucceeded] = useState(false);\n    const [error, setError] = useState(null);\n    const [disabled, setDisabled] = useState(true);\n    const [clientSecret, setClientSecret] = useState(true);\n\n    useEffect(() => {\n        const getClientSecret = async () => {\n            const response = await axios({\n                method: 'post',\n                url: `/payments/create?total=${getBasketTotal(basket) * 100}`\n            });\n            setClientSecret(response.data.clientSecret)\n        }\n        getClientSecret();\n    }, [basket])\n\n    const handleSubmit = async (event) => {\n        event.preventDefault();\n        setProcessing(true);\n\n        const payload = await stripe.confirmCardPayment(clientSecret, {\n            payment_method: {\n                card: elements.getElement(CardElement)\n            }\n        }).then(({ paymentIntent }) => {\n            db\n                .collection('users')\n                .doc(user?.uid)\n                .collection('orders')\n                .doc(paymentIntent.id)\n                .set({\n                    basket: basket,\n                    amount: paymentIntent.amount,\n                    created: paymentIntent.created\n                });\n\n            setSucceeded(true);\n            setError(null);\n            setProcessing(false);\n\n            dispatch({\n                type: \"EMPTY_BASKET\"\n            });\n\n            history.replace(\"/orders\");\n        })\n    }\n\n    const handleChange = event => {\n        setDisabled(event.empty);\n        setError(event.error ? event.error.message : \"\");\n    }\n\n    return (\n        <div className=\"payment\">\n            <div className=\"payment__container\">\n                <h1>\n                    Checkout (<Link to=\"/checkout\">\n                        {basket?.length} items\n                    </Link>)\n                </h1>\n\n                <div className=\"payment__section\">\n                    <div className=\"payment__title\">\n                        <h3>Delivery Address</h3>\n                    </div>\n                    <div className=\"payment__address\">\n                        <p>{!user ? \"Guest\" : user?.email}</p>\n                        <textarea cols=\"30\" rows=\"5\" placeholder=\"Enter address\"></textarea>\n                    </div>\n                </div>\n\n                <div className=\"payment__section\">\n                    <div className=\"payment__title\">\n                        <h3>Review items and delivery</h3>\n                    </div>\n                    <div className=\"payment__items\">\n                        {basket.map(item => (\n                            <CheckoutProduct\n                                id={item.id}\n                                image={item.image}\n                                title={item.title}\n                                price={item.price}\n                                rating={item.rating}\n                            />\n                        ))}\n                    </div>\n                </div>\n\n                <div className=\"payment__section\">\n                    <div className=\"payment__title\">\n                        <h3>Payment Method</h3>\n                    </div>\n                    <div className=\"payment__details\">\n                        <form onSubmit={handleSubmit}>\n                            <CardElement onChange={handleChange} />\n                            <div className=\"payment__priceContainer\">\n                                <CurrencyFormat\n                                    renderText={(value) => (\n                                        <h3>Order Total: {value}</h3>\n                                    )}\n                                    decimalScale={2}\n                                    value={getBasketTotal(basket)}\n                                    displayType={\"text\"}\n                                    thousandSeparator={true}\n                                    prefix={\"$\"}\n                                />\n                                <button disabled={processing || disabled || succeeded}>\n                                    <span>{processing ? <p>Processing</p> : \"Buy now\"}</span>\n                                </button>\n                            </div>\n                            {error && <div>{error}</div>}\n                        </form>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n\nexport default Payment;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}